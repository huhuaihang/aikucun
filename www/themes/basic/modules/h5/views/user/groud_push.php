<?phpuse app\assets\ApiAsset;use app\assets\LayerAsset;use app\assets\VueAsset;use yii\helpers\Url;/** * @var $this \yii\web\View */ApiAsset::register($this);LayerAsset::register($this);VueAsset::register($this);$this->title = '优惠券活动';?><div class="box" id="app">    <div class="new_header">        <a href="javascript:void(0)" onClick="window.history.go(-1);" class="a1"><img src="/images/new_header.png"></a>        <a href="#" class="a2">优惠券活动</a>    </div><!--new_header-->    <div class="groud_s">        <img src="/images/banner_1.png" alt="">    </div>    <div class="groud_tit">        优惠券    </div>    <div class="groud_y">        <ul v-if="coupon_list.length>0">            <li class="groud_li_b" v-for="coupon in coupon_list" v-if="coupon.status == 3">                <p class="groud_li_p1">{{coupon.name}}</p>                <p class="groud_li_p2">¥{{coupon.price}}</p>                <p class="groud_li_p3">{{coupon.create_time | timeFormat }}</p>                <div class="groud_li_p4" >                    <p>已使用</p>                </div>            </li>            <li class="groud_li_p" v-else>                <p class="groud_li_p1">{{coupon.name}}</p>                <p class="groud_li_p2">¥{{coupon.price}}</p>                <p class="groud_li_p3">{{coupon.create_time | timeFormat }}</p>            </li>        </ul>        <ul v-else>            <li class="groud_li_b" v-for="n in coupon_info.count">                <p class="groud_li_p1">{{coupon_info.name}}</p>                <p class="groud_li_p2">¥{{coupon_info.price}}</p>            </li>        </ul>    </div>    <div class="groud_tit">        商品名称    </div>    <div class="groud_v">        <img :src="main_pic" alt="">    </div>    <div class="groud_tit"  v-if="gif_is_show == 1">        请选择一件赠品    </div>    <div class="groud_w">        <ul v-if="gif_is_show == 1">            <li v-for="gift in coupon_gift_list"  @click="check(gift.id)">                <img :src="gift.pic" alt="">                <img v-if="gift.id == gift_id" src="/images/groud5.jpg" alt="">                <img v-else src="/images/groud6.jpg" alt="">            </li>        </ul>    </div>    <div class="groud_tit">        活动介绍    </div>    <div class="groud_v">        <iframe :src="web_view_url"  style="width: 100%;"  onload="setIframeHeight(this)"   frameborder="0"  ></iframe>    </div>    <div style="height: 1rem;"></div>    <div class="groud_button">        <a @click="confirm">立即购买</a>    </div></div><script>    var app = new Vue({        el: '#app',        data: {            coupon_list: [],//优惠券列表            coupon_gift_list:[],//赠品列表            coupon_info:[],//优惠券信息            gif_is_show:0,//赠品是否显示            gid:'',//活动商品id            main_pic:'',//活动商品主图            gift_id:'',//选中赠品id            web_view_url:''        },        methods: {            //选择赠品            check:function(id){               this.gift_id = id ;            },            loadGroud: function () {                apiGet('/api/user/ground-push', {}, function(json) {                    if (callback(json)) {                        console.log(json)                        app.coupon_list = json['coupon_list'];                        app.coupon_gift_list = json['coupon_gift_list'];                        app.coupon_info = json['rule'];                        app.gid = json['gid'];                        app.main_pic = json['main_pic'];                        app.gif_is_show = json['gif_is_show'];                        app.web_view_url = json['web_view_url'];                        if(json['coupon_gift_list'].length > 0)                        {                        app.gift_id = json['coupon_gift_list'][0]['id'];                        }                    }                });            },            confirm: function () {                if (<?php echo Yii::$app->user->identity['status']; ?> == 1 )                {                    window.location.href = '<?php echo Url::to(['/h5/order/confirm']);?>' + '?type=goods&gid=' + this.gid + '&gift_id=' + this.gift_id + '&amount=1';                }                else                {                    //底部对话框                    layer.open({                        content: '该活动只可激活会员参与，马上激活吧！',                        btn: ['去激活'],                        yes: function (index) {                            window.location.href = '/activate/ytbhuiyuan20190704/index.html';                        }                    });                }            }        },        filters: {            timeFormat: function (value) {                var date = new Date(value * 1000);                var y = date.getFullYear();                var M = date.getMonth() + 1;                var d = date.getDate();                var h = date.getHours();                var m = date.getMinutes();                var s = date.getSeconds();                if (M < 10) {                    M = '0' + M;                }                if (d < 10) {                    d = '0' + d;                }                if (h < 10) {                    h = '0' + h;                }                if (m < 10) {                    m = '0' + m;                }                if (s < 10) {                    s = '0' + s;                }                return y + '-' + M + '-' + d ;            }        },        mounted: function () {            this.loadGroud();        }    });    function setIframeHeight(iframe) {        if (iframe) {            var iframeWin = iframe.contentWindow || iframe.contentDocument.parentWindow;            if (iframeWin.document.body) {                iframe.height = iframeWin.document.documentElement.scrollHeight || iframeWin.document.body.scrollHeight;            }        }    };</script>